<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Boaz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #calendar {
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f4f4f4;
        }
        #reportContent {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Relatórios de Entregas - Boaz</h1>
    <input type="date" id="calendar">
    <div id="reportContent">
        <!-- Conteúdo do relatório será carregado aqui -->
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js';
        import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB-pF2lRStLTN9Xw9aYQj962qdNFyUXI2E",
            authDomain: "cabana-8d55e.firebaseapp.com",
            databaseURL: "https://cabana-8d55e-default-rtdb.firebaseio.com",
            projectId: "cabana-8d55e",
            storageBucket: "cabana-8d55e.appspot.com",
            messagingSenderId: "706144237954",
            appId: "1:706144237954:web:345c10370972486afc779b",
            measurementId: "G-96Y337GYT8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === 'boazd3@gmail.com') {
                document.getElementById('calendar').addEventListener('change', loadReport);
            } else {
                window.location.href = 'index.html';
            }
        });

        async function loadReport() {
            const selectedDate = document.getElementById('calendar').value;
            if (selectedDate) {
                try {
                    const db = getDatabase();
                    const reportRef = ref(db, `motoboys/boaz/${selectedDate}`);
                    const snapshot = await get(reportRef);
                    
                    if (snapshot.exists()) {
                        displayReport(snapshot.val());
                    } else {
                        document.getElementById('reportContent').innerHTML = '<p>Nenhum relatório encontrado para esta data.</p>';
                    }
                } catch (error) {
                    console.error('Erro ao carregar o relatório:', error);
                    document.getElementById('reportContent').innerHTML = '<p>Erro ao carregar o relatório. Tente novamente mais tarde.</p>';
                }
            }
        }

        function displayReport(data) {
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = '';

            const table = document.createElement('table');
            const headers = ['Nome', 'Data', 'Qtd. Entregas', 'Entregas na mesma casa', 'Turnos', 'PIX', 'Observações', 'Total a receber'];
            
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            const row = document.createElement('tr');
            [data.nome, data.data, data.qtdEntregas, data.entregasMesmaCasa, data.turnos, data.pix, data.observacoes, data.totalReceber].forEach(value => {
                const td = document.createElement('td');
                td.textContent = value;
                row.appendChild(td);
            });
            table.appendChild(row);

            reportContent.appendChild(table);
        }
    </script>
</body>
</html>
