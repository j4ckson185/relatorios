<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo com Widgets Personalizáveis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #333;
        }
        input, button {
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #resultado, #previsao-horaria, #clima-evento {
            margin-top: 20px;
        }
        .widget {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        .widget-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .widget-controls button {
            width: auto;
            padding: 5px 10px;
        }
        #widgets-container {
            margin-top: 20px;
        }
        #widget-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        #widget-options label {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Previsão do Tempo</h1>
        <input type="text" id="cidade" placeholder="Digite o nome da cidade">
        <button onclick="buscarPrevisao()">Buscar Previsão</button>
        
        <h2>Widgets Personalizáveis</h2>
        <div id="widget-options">
            <label><input type="checkbox" value="atual" checked> Clima Atual</label>
            <label><input type="checkbox" value="proximos-dias" checked> Próximos Dias</label>
            <label><input type="checkbox" value="horaria" checked> Previsão por Hora</label>
            <label><input type="checkbox" value="evento" checked> Previsão para Evento</label>
        </div>
        <button onclick="atualizarWidgets()">Atualizar Widgets</button>

        <div id="widgets-container"></div>

        <div id="resultado"></div>
        <div id="previsao-horaria"></div>
        
        <h3>Verificar Clima para Evento</h3>
        <input type="date" id="data-evento">
        <button onclick="verificarClimaEvento()">Verificar Clima para Evento</button>
        <div id="clima-evento"></div>
    </div>

    <script>
        const apiKey = 'SUA_API_KEY_AQUI'; // Substitua pela sua chave da API OpenWeatherMap

        function buscarPrevisao() {
            const cidade = document.getElementById('cidade').value;
            if (!cidade) {
                alert('Por favor, digite o nome da cidade.');
                return;
            }

            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(cidade)}&appid=${apiKey}&units=metric&lang=pt_br`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    exibirPrevisaoAtual(data);
                    exibirPrevisaoProximosDias(data);
                    exibirPrevisaoHoraria(data);
                })
                .catch(error => {
                    console.error('Erro ao buscar previsão:', error);
                    document.getElementById('resultado').innerHTML = '<p>Erro ao buscar previsão. Tente novamente mais tarde.</p>';
                });
        }

        function exibirPrevisaoAtual(data) {
            const climaAtual = data.list[0];
            const htmlAtual = `
                <h2>Clima atual em ${data.city.name}</h2>
                <p>Temperatura: ${Math.round(climaAtual.main.temp)}°C</p>
                <p>Condição: ${climaAtual.weather[0].description}</p>
                <p>Umidade: ${climaAtual.main.humidity}%</p>
                <p>Vento: ${climaAtual.wind.speed} m/s</p>
            `;
            document.getElementById('resultado').innerHTML = htmlAtual;
        }

        function exibirPrevisaoProximosDias(data) {
            let htmlProximosDias = '<h2>Previsão para os próximos dias</h2>';
            const dataAtual = new Date().toDateString();
            
            data.list.forEach(previsao => {
                const dataPrevisao = new Date(previsao.dt * 1000).toDateString();
                if (dataPrevisao !== dataAtual) {
                    htmlProximosDias += `
                        <h3>${new Date(previsao.dt * 1000).toLocaleDateString()}</h3>
                        <p>Temperatura: ${Math.round(previsao.main.temp)}°C</p>
                        <p>Condição: ${previsao.weather[0].description}</p>
                        <p>Probabilidade de chuva: ${(previsao.pop * 100).toFixed(0)}%</p>
                    `;
                    dataAtual = dataPrevisao;
                }
            });

            document.getElementById('resultado').innerHTML += htmlProximosDias;
        }

        function exibirPrevisaoHoraria(data) {
            let htmlHoraria = '<h2>Previsão por hora</h2>';
            
            data.list.slice(0, 8).forEach(previsao => {
                htmlHoraria += `
                    <h3>${new Date(previsao.dt * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</h3>
                    <p>Temperatura: ${Math.round(previsao.main.temp)}°C</p>
                    <p>Condição: ${previsao.weather[0].description}</p>
                    <p>Probabilidade de chuva: ${(previsao.pop * 100).toFixed(0)}%</p>
                `;
            });

            document.getElementById('previsao-horaria').innerHTML = htmlHoraria;
        }

        function verificarClimaEvento() {
            const dataEvento = document.getElementById('data-evento').value;
            if (!dataEvento) {
                alert('Por favor, selecione uma data para o evento.');
                return;
            }

            const cidade = document.getElementById('cidade').value;
            if (!cidade) {
                alert('Por favor, digite o nome da cidade primeiro.');
                return;
            }

            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(cidade)}&appid=${apiKey}&units=metric&lang=pt_br`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const previsaoEvento = data.list.find(previsao => {
                        const dataPrevisao = new Date(previsao.dt * 1000);
                        return dataPrevisao.toDateString() === new Date(dataEvento).toDateString();
                    });

                    if (previsaoEvento) {
                        const climaEvento = document.getElementById('clima-evento');
                        climaEvento.innerHTML = `
                            <h3>Previsão para o evento (${new Date(dataEvento).toLocaleDateString()}):</h3>
                            <p>Temperatura: ${Math.round(previsaoEvento.main.temp)}°C</p>
                            <p>Condição: ${previsaoEvento.weather[0].description}</p>
                            <p>Probabilidade de chuva: ${(previsaoEvento.pop * 100).toFixed(0)}%</p>
                        `;

                        if (previsaoEvento.pop > 0.5) {
                            enviarNotificacao('Alerta de Chuva', `Há uma alta probabilidade de chuva (${(previsaoEvento.pop * 100).toFixed(0)}%) no dia do seu evento.`);
                        }
                    } else {
                        document.getElementById('clima-evento').innerHTML = '<p>Previsão não disponível para esta data.</p>';
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar previsão para o evento:', error);
                    document.getElementById('clima-evento').innerHTML = '<p>Erro ao buscar previsão para o evento.</p>';
                });
        }

        function enviarNotificacao(titulo, mensagem) {
            if (Notification.permission === "granted") {
                new Notification(titulo, { body: mensagem });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(titulo, { body: mensagem });
                    }
                });
            }
        }

        function solicitarPermissaoNotificacao() {
            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        }

        function atualizarWidgets() {
            const widgetsContainer = document.getElementById('widgets-container');
            widgetsContainer.innerHTML = '';

            const opcoes = document.querySelectorAll('#widget-options input:checked');
            opcoes.forEach(opcao => {
                const widget = criarWidget(opcao.value);
                widgetsContainer.appendChild(widget);
            });

            buscarPrevisao();
        }

        function criarWidget(tipo) {
            const widget = document.createElement('div');
            widget.className = 'widget';
            widget.id = `widget-${tipo}`;

            const controles = document.createElement('div');
            controles.className = 'widget-controls';

            const titulo = document.createElement('h3');
            titulo.textContent = obterTituloWidget(tipo);

            const botaoRemover = document.createElement('button');
            botaoRemover.textContent = 'Remover';
            botaoRemover.onclick = () => removerWidget(tipo);

            controles.appendChild(titulo);
            controles.appendChild(botaoRemover);

            widget.appendChild(controles);
            return widget;
        }

        function obterTituloWidget(tipo) {
            switch(tipo) {
                case 'atual': return 'Clima Atual';
                case 'proximos-dias': return 'Próximos Dias';
                case 'horaria': return 'Previsão por Hora';
                case 'evento': return 'Previsão para Evento';
                default: return 'Widget';
            }
        }

        function removerWidget(tipo) {
            const widget = document.getElementById(`widget-${tipo}`);
            if (widget) {
                widget.remove();
            }
            const checkbox = document.querySelector(`#widget-options input[value="${tipo}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            solicitarPermissaoNotificacao();
            atualizarWidgets();
        });
    </script>
</body>
</html>
