<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabana Açaí - Sistema de Entrega</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        /* ... (estilos anteriores permanecem os mesmos) ... */
        #motoboys {
            margin-top: 20px;
        }
        .motoboy-item {
            margin-bottom: 10px;
            padding: 5px;
            background-color: #e6f3ff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .assign-btn {
            margin-left: 10px;
            padding: 2px 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .status-pending {
            color: orange;
        }
        .status-assigned {
            color: blue;
        }
        .status-delivered {
            color: green;
        }
    </style>
</head>
<body>
    <!-- ... (estrutura HTML anterior permanece a mesma) ... -->
    <div id="content">
        <div id="sidebar">
            <h2>Pedidos</h2>
            <button id="newOrderBtn">Novo Pedido</button>
            <form id="orderForm">
                <!-- ... (campos do formulário permanecem os mesmos) ... -->
            </form>
            <div id="orderList"></div>
            <h2>Motoboys</h2>
            <div id="motoboyList"></div>
        </div>
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Dados de exemplo para os pedidos (agora com status)
        let orders = [
            { id: 1, client: "João", street: "Rua A", number: "123", neighborhood: "Centro", status: "pending" },
            { id: 2, client: "Maria", street: "Av. B", number: "456", neighborhood: "Potengi", status: "pending" },
            { id: 3, client: "Pedro", street: "Praça C", number: "789", neighborhood: "Lagoa Nova", status: "pending" }
        ];

        // Lista de motoboys
        let motoboys = [
            { id: 1, name: "Carlos" },
            { id: 2, name: "Ana" },
            { id: 3, name: "Rafael" }
        ];

        // ... (código do mapa e outras funções permanecem os mesmos) ...

        // Função para renderizar a lista de pedidos (atualizada)
        function renderOrderList() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            orders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <strong>Pedido #${order.id}</strong><br>
                    Cliente: ${order.client}<br>
                    Endereço: ${order.street}, ${order.number}, ${order.neighborhood}<br>
                    Status: <span class="status-${order.status}">${getStatusText(order.status)}</span>
                    <button class="editBtn" data-id="${order.id}">Editar</button>
                    ${order.status === 'pending' ? `<button class="assignBtn" data-id="${order.id}">Atribuir</button>` : ''}
                    ${order.status === 'assigned' ? `<button class="deliverBtn" data-id="${order.id}">Marcar como Entregue</button>` : ''}
                `;
                orderItem.addEventListener('click', () => toggleOrderSelection(order));
                orderList.appendChild(orderItem);
            });

            // Adicionar event listeners para os botões
            document.querySelectorAll('.editBtn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const orderId = parseInt(e.target.getAttribute('data-id'));
                    editOrder(orderId);
                });
            });

            document.querySelectorAll('.assignBtn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const orderId = parseInt(e.target.getAttribute('data-id'));
                    showMotoboyAssignmentModal(orderId);
                });
            });

            document.querySelectorAll('.deliverBtn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const orderId = parseInt(e.target.getAttribute('data-id'));
                    markOrderAsDelivered(orderId);
                });
            });
        }

        // Função para obter o texto do status
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Pendente';
                case 'assigned': return 'Atribuído';
                case 'delivered': return 'Entregue';
                default: return 'Desconhecido';
            }
        }

        // Função para mostrar modal de atribuição de motoboy
        function showMotoboyAssignmentModal(orderId) {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.left = '50%';
            modal.style.top = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            modal.style.backgroundColor = 'white';
            modal.style.padding = '20px';
            modal.style.border = '1px solid black';
            modal.style.zIndex = '1000';

            modal.innerHTML = `
                <h3>Atribuir Pedido #${orderId} a um Motoboy</h3>
                <select id="motoboySelect">
                    ${motoboys.map(motoboy => `<option value="${motoboy.id}">${motoboy.name}</option>`).join('')}
                </select>
                <button id="confirmAssign">Confirmar</button>
                <button id="cancelAssign">Cancelar</button>
            `;

            document.body.appendChild(modal);

            document.getElementById('confirmAssign').addEventListener('click', () => {
                const motoboyId = document.getElementById('motoboySelect').value;
                assignOrderToMotoboy(orderId, parseInt(motoboyId));
                document.body.removeChild(modal);
            });

            document.getElementById('cancelAssign').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // Função para atribuir pedido a um motoboy
        function assignOrderToMotoboy(orderId, motoboyId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'assigned';
                order.motoboyId = motoboyId;
                renderOrderList();
                updateMap();
            }
        }

        // Função para marcar pedido como entregue
        function markOrderAsDelivered(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'delivered';
                renderOrderList();
                updateMap();
            }
        }

        // Função para renderizar a lista de motoboys
        function renderMotoboyList() {
            const motoboyList = document.getElementById('motoboyList');
            motoboyList.innerHTML = '';
            motoboys.forEach(motoboy => {
                const motoboyItem = document.createElement('div');
                motoboyItem.className = 'motoboy-item';
                motoboyItem.innerHTML = `
                    <strong>${motoboy.name}</strong>
                    <button class="viewOrdersBtn" data-id="${motoboy.id}">Ver Pedidos</button>
                `;
                motoboyList.appendChild(motoboyItem);
            });

            document.querySelectorAll('.viewOrdersBtn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const motoboyId = parseInt(e.target.getAttribute('data-id'));
                    showMotoboyOrders(motoboyId);
                });
            });
        }

        // Função para mostrar os pedidos de um motoboy
        function showMotoboyOrders(motoboyId) {
            const motoboyOrders = orders.filter(order => order.motoboyId === motoboyId && order.status === 'assigned');
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.left = '50%';
            modal.style.top = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            modal.style.backgroundColor = 'white';
            modal.style.padding = '20px';
            modal.style.border = '1px solid black';
            modal.style.zIndex = '1000';

            modal.innerHTML = `
                <h3>Pedidos do Motoboy ${motoboys.find(m => m.id === motoboyId).name}</h3>
                <ul>
                    ${motoboyOrders.map(order => `
                        <li>
                            Pedido #${order.id}: ${order.client} - ${order.street}, ${order.number}, ${order.neighborhood}
                        </li>
                    `).join('')}
                </ul>
                <button id="closeModal">Fechar</button>
            `;

            document.body.appendChild(modal);

            document.getElementById('closeModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // ... (restante do código JavaScript permanece o mesmo) ...

        // Inicializar a lista de pedidos, motoboys e o mapa
        renderOrderList();
        renderMotoboyList();
        updateMap();

        // Centralizar o mapa na Rua Serra do Mar, 1216, Potengi
        geocodeAddress({ street: "Rua Serra do Mar", number: "1216", neighborhood: "Potengi" });
    </script>
</body>
</html>
