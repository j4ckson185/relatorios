<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Pedidos - Foody Delivery</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-pF2lRStLTN9Xw9aYQj962qdNFyUXI2E&libraries=visualization"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos existentes */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 300px;
            background-color: #2c3e50;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }
        #map {
            height: 60vh;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .dashboard {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .metric-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            width: 32%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .metric-title {
            font-size: 14px;
            color: #4a4a4a;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        .order-list {
            flex-grow: 1;
            overflow-y: auto;
        }
        .order-item {
            background-color: #fff;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .order-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        h2 {
            color: #ecf0f1;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        .order-options {
            position: absolute;
            right: 10px;
            top: 10px;
        }
        .order-options i {
            cursor: pointer;
            margin-left: 5px;
            color: #3498db;
            transition: color 0.3s ease;
        }
        .order-options i:hover {
            color: #2980b9;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
            background-color: #fadbd8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .status-open { color: #e74c3c; }
        .status-accepted { color: #f1c40f; }
        .status-ready { color: #8E44AD; }
        .status-onGoing { color: #87CEEB; }
        .status-dispatched { color: #e67e22; }
        .action-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            width: 100%;
        }
        .action-button:hover {
            background-color: #2980b9;
        }
        #paymentBreakdown {
            font-size: 12px;
            margin-top: 5px;
        }
        .label {
            color: #4a4a4a;
        }

        /* Estilos para o novo formulário de criação de pedidos */
        #createOrderSection {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #createOrderForm {
            display: none;
        }
        #createOrderForm input,
        #createOrderForm select,
        #createOrderForm textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #createOrderForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #toggleFormButton {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }
        #toggleFormButton:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Pedidos</h2>
            <div id="orderList" class="order-list"></div>
            <button id="resetButton" class="action-button" onclick="resetCounters()">Zerar Contadores</button>
            <button id="reportsButton" class="action-button" onclick="window.open('relatorios.html', '_blank')">Relatórios</button>
        </div>
        <div class="main-content">
            <div id="createOrderSection">
                <button id="toggleFormButton" onclick="toggleCreateOrderForm()">Criar Novo Pedido</button>
                <form id="createOrderForm" style="display: none;">
                    <label for="orderId">ID do Pedido:</label>
                    <input type="text" id="orderId" required>

                    <label for="customerName">Nome do Cliente:</label>
                    <input type="text" id="customerName" required>

                    <label for="customerPhone">Telefone do Cliente:</label>
                    <input type="text" id="customerPhone" required>

                    <label for="street">Logradouro:</label>
                    <input type="text" id="street" required>

                    <label for="streetNumber">Número:</label>
                    <input type="text" id="streetNumber" required>

                    <label for="neighborhood">Bairro:</label>
                    <input type="text" id="neighborhood" required>

                    <label for="complement">Complemento:</label>
                    <input type="text" id="complement">

                    <label for="zipCode">CEP:</label>
                    <input type="text" id="zipCode" required>

                    <label for="status">Status:</label>
                    <select id="status" required>
                        <option value="open">Aberto</option>
                        <option value="ready">Pronto</option>
                    </select>

                    <label for="orderDetails">Detalhes do Pedido:</label>
                    <textarea id="orderDetails" required></textarea>

                    <label>Método de Pagamento:</label>
                    <div>
                        <input type="radio" id="paymentMoney" name="paymentMethod" value="money" required>
                        <label for="paymentMoney">Dinheiro</label>
                        <input type="radio" id="paymentCard" name="paymentMethod" value="card">
                        <label for="paymentCard">Cartão</label>
                        <input type="radio" id="paymentOnline" name="paymentMethod" value="online">
                        <label for="paymentOnline">Online</label>
                    </div>

                    <label for="orderTotal">Valor Total:</label>
                    <input type="number" id="orderTotal" step="0.01" required>

                    <label for="notes">Observações:</label>
                    <textarea id="notes"></textarea>

                    <button type="button" onclick="submitOrder()" class="action-button">Criar Pedido</button>
                </form>
            </div>
            <div id="map"></div>
            <div class="dashboard">
                <!-- Dashboard content remains the same -->
            </div>
        </div>
    </div>

    <!-- Existing modals and popups remain the same -->

    <script>
        // Existing JavaScript code remains the same

        // New functions for create order form
        function toggleCreateOrderForm() {
            const form = document.getElementById('createOrderForm');
            const button = document.getElementById('toggleFormButton');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                button.textContent = 'Ocultar Formulário';
            } else {
                form.style.display = 'none';
                button.textContent = 'Criar Novo Pedido';
            }
        }

        async function submitOrder() {
            const order = {
                id: document.getElementById('orderId').value,
                status: document.getElementById('status').value,
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value,
                orderTotal: Number(document.getElementById('orderTotal').value),
                notes: document.getElementById('notes').value,
                orderDetails: document.getElementById('orderDetails').value,
                deliveryPoint: {
                    address: `${document.getElementById('street').value}, ${document.getElementById('streetNumber').value}, ${document.getElementById('neighborhood').value}`,
                    street: document.getElementById('street').value,
                    houseNumber: document.getElementById('streetNumber').value,
                    complement: document.getElementById('complement').value,
                    postalCode: document.getElementById('zipCode').value,
                    city: "Natal",
                    region: "RN",
                    country: "BR"
                },
                customer: {
                    customerPhone: document.getElementById('customerPhone').value,
                    customerName: document.getElementById('customerName').value
                }
            };

            try {
                const response = await fetch('https://us-central1-cabana-8d55e.cloudfunctions.net/foodyDeliveryApi/createOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': authToken
                    },
                    body: JSON.stringify(order)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Pedido criado:', result);
                alert('Pedido criado com sucesso!');
                document.getElementById('createOrderForm').reset();
                fetchOrders(); // Atualiza a lista de pedidos
            } catch (error) {
                console.error('Erro ao criar pedido:', error);
                alert('Erro ao criar pedido: ' + error.message);
            }
        }

        // Initialize the application
        loadDataFromLocalStorage();
        initMap();
        fetchOrders();
        setInterval(fetchOrders, 10000); // Update every 10 seconds
    </script>
</body>
</html>
